!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,n.StateMachineRouter=t()}}(function(){var t;return function n(t,e,r){function i(u,f){if(!e[u]){if(!t[u]){var s="function"==typeof require&&require;if(!f&&s)return s(u,!0);if(o)return o(u,!0);var c=new Error("Cannot find module '"+u+"'");throw c.code="MODULE_NOT_FOUND",c}var a=e[u]={exports:{}};t[u][0].call(a.exports,function(n){var e=t[u][1][n];return i(e?e:n)},a,a.exports,n,t,e,r)}return e[u].exports}for(var o="function"==typeof require&&require,u=0;u<r.length;u++)i(r[u]);return i}({1:[function(t,n,e){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function i(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function o(t){var n=this,e=c(t),r=new h.Automaton(e);this.start=function(){var e=u(t)||[],i=p(e,3),o=i[0],f=i[1],s=i[2];return window.addEventListener("popstate",function(e){var i=e.state,o={query:window.location.search},f=u(t)||[],s=p(f,2),c=s[0],a=s[1],l=Object.assign(a,i);r.process(m).then(function(){return r.process(c,n,l,o)})}),r.startWith(w.ROUTING).then(function(){return r.process(o,n,f,s)})},this.process=function(e){var i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],u=r.currentState(),f=t[u],s=f.transitions[e];if(!s)throw new Error('Input "'+e+'" could not be processed in state "'+u+'"');return r.process(m).then(function(){return r.process(s,n,i,o)}).then(function(){var n=t[s];a(n.url,n.title,i,o.query)})},this.toString=function(){return JSON?JSON.stringify(e):e},this.currentState=function(){return r.currentState()},this.on=function(){for(var t=arguments.length,n=Array(t),e=0;t>e;e++)n[e]=arguments[e];return r.on.apply(r,n)},this.off=function(){for(var t=arguments.length,n=Array(t),e=0;t>e;e++)n[e]=arguments[e];return r.off.apply(r,n)}}function u(t){var n=window.location.pathname,e=window.location.search,r=f(n,t);return r?r.concat({query:e}):null}function f(t,n){function e(n){if(-1===n.indexOf(g))return n===t?{}:null;var e=(0,d.named)(new RegExp(n)),r=e.exec(t)||[],i=r.captures,o=i&&Object.keys(i).length===r.length-1;return o?s(i):null}for(var r in n)if(n.hasOwnProperty(r)){var i=n[r],o=e(i.url);if(o)return[r,o]}}function s(t){return Object.keys(t).reduce(function(n,e){return Object.assign(n,i({},e,t[e][0]))},{})}function c(t){function n(t){return Object.keys(t).reduce(function(t,n){return Object.assign(t,i({},n,n))},{})}function e(t){return Object.keys(t).reduce(function(n,e){return n[e]=Object.assign({},t[e]),n[e].transitions[m]=w.ROUTING,n},{})}return Object.assign({},e(t),i({},w.ROUTING,{transitions:n(t)}))}function a(t,n){var e=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],r=arguments.length<=3||void 0===arguments[3]?"":arguments[3],i=l(t),o=(0,y["default"])(i,e)+r;o!==window.location.href&&history.pushState(e,n,o),n&&(document.title=n)}function l(t){if(-1===t.indexOf(g))return t;var n=t.replace(/\(:<(\w+)>.+?\)/gi,function(t,n){return"{"+n+"}"});return n}Object.defineProperty(e,"__esModule",{value:!0}),e.EVENTS=void 0;var p=function(){function t(t,n){var e=[],r=!0,i=!1,o=void 0;try{for(var u,f=t[Symbol.iterator]();!(r=(u=f.next()).done)&&(e.push(u.value),!n||e.length!==n);r=!0);}catch(s){i=!0,o=s}finally{try{!r&&f["return"]&&f["return"]()}finally{if(i)throw o}}return e}return function(n,e){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return t(n,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=t("kristi");Object.defineProperty(e,"EVENTS",{enumerable:!0,get:function(){return h.EVENTS}}),e.Router=o,e.matchLocationToState=u,e.stateByUrl=f,e.flatCaptures=s,e.addRoutingHoles=c,e.urlRegExpToTemplate=l;var d=t("named-regexp"),v=t("string-format"),y=r(v),g="(:<",w={ROUTING:"--routing--"},m="--routing_requested--"},{kristi:2,"named-regexp":4,"string-format":5}],2:[function(n,e,r){(function(i){!function(n){if("object"==typeof r&&"undefined"!=typeof e)e.exports=n();else if("function"==typeof t&&t.amd)t([],n);else{var o;o="undefined"!=typeof window?window:"undefined"!=typeof i?i:"undefined"!=typeof self?self:this,o.Kristi=n()}}(function(){return function t(e,r,i){function o(f,s){if(!r[f]){if(!e[f]){var c="function"==typeof n&&n;if(!s&&c)return c(f,!0);if(u)return u(f,!0);var a=new Error("Cannot find module '"+f+"'");throw a.code="MODULE_NOT_FOUND",a}var l=r[f]={exports:{}};e[f][0].call(l.exports,function(t){var n=e[f][1][t];return o(n?n:t)},l,l.exports,t,e,r,i)}return r[f].exports}for(var u="function"==typeof n&&n,f=0;f<i.length;f++)o(i[f]);return o}({1:[function(t,n,e){var r=function(){};r.prototype={bind:function(t,n){this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(n)},unbind:function(t,n){this._events=this._events||{},t in this._events!=!1&&this._events[t].splice(this._events[t].indexOf(n),1)},trigger:function(t){if(this._events=this._events||{},t in this._events!=!1)for(var n=0;n<this._events[t].length;n++)this._events[t][n].apply(this,Array.prototype.slice.call(arguments,1))}},r.mixin=function(t){for(var n=["bind","unbind","trigger"],e=0;e<n.length;e++)t.prototype[n[e]]=r.prototype[n[e]]},"undefined"!=typeof n&&"exports"in n&&(n.exports=r)},{}],2:[function(t,n,e){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function i(t){function n(n,r){var i=arguments.length<=2||void 0===arguments[2]?[]:arguments[2],o=r&&t[r];if(!c&&o){c=!0;var u=Promise.resolve(!0),f=l&&l.exit,p=o.enter;return"function"==typeof f&&(u=u.then(function(){return f.call(n)})),"function"==typeof p&&(u=u.then(function(){return p.apply(n,i)})),u.then(function(){var t={from:a,to:r};return a=r,l=o,c=!1,e(s.TRANSITION,t),!0})}}function e(){for(var t=arguments.length,n=Array(t),e=0;t>e;e++)n[e]=arguments[e];i.trigger.apply(i,n)}var r=this,i=new f["default"],u=!1,c=!1,a=void 0,l=void 0;this.startWith=function(t){if(u)throw new Error("Automaton already runned");return u=!0,n(r,t)},this.process=function(i){if(!u)throw new Error("Automaton is not runned");var f={state:a,event:i};e(s.PROCESSING,f);for(var c=arguments.length,l=Array(c>1?c-1:0),p=1;c>p;p++)l[p-1]=arguments[p];return n(r,o(t,a,i),l)},this.currentState=function(){return a},this.on=function(t,n){return i.bind(t,n),this},this.off=function(t,n){return i.unbind(t,n),this}}function o(t,n,e){var r=t[n];return r&&r.transitions?r.transitions[e]||null:null}Object.defineProperty(e,"__esModule",{value:!0}),e.EVENTS=void 0,e.Automaton=i,e.nextState=o;var u=t("microevent"),f=r(u),s=e.EVENTS={TRANSITION:"transition",PROCESSING:"processing"}},{microevent:1}]},{},[2])(2)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{microevent:3}],3:[function(t,n,e){var r=function(){};r.prototype={bind:function(t,n){this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(n)},unbind:function(t,n){this._events=this._events||{},t in this._events!=!1&&this._events[t].splice(this._events[t].indexOf(n),1)},trigger:function(t){if(this._events=this._events||{},t in this._events!=!1)for(var n=0;n<this._events[t].length;n++)this._events[t][n].apply(this,Array.prototype.slice.call(arguments,1))}},r.mixin=function(t){for(var n=["bind","unbind","trigger"],e=0;e<n.length;e++)t.prototype[n[e]]=r.prototype[n[e]]},"undefined"!=typeof n&&"exports"in n&&(n.exports=r)},{}],4:[function(t,n,e){function r(t){var n=[],e=new RegExp(t.source.replace(/\(:<(\w+)>/g,function(t,e){return n.push(e),"("}),(t.global?"g":"")+(t.ignoreCase?"i":"")+(t.multiline?"m":"")),r=function(t){if(!t)return t;for(var e={},r=0,i=n.length;i>r;r++){var o=n[r];e[o]||(e[o]=[]),e[o].push(t[r+1])}return t.captures=e,t.capture=function(t){return e[t][e[t].length-1]},t};return e.exec=function(t){return r(RegExp.prototype.exec.call(this,t))},e.replace=function(t,n){return"function"==typeof n?t.replace(this,function(){return n(r(Array.prototype.slice.call(arguments)))}):t.replace(this,n)},e}this.named=r},{}],5:[function(n,e,r){(function(){var n,r,i,o,u,f,s,c={}.hasOwnProperty,a=function(t,n){function e(){this.constructor=t}for(var r in n)c.call(n,r)&&(t[r]=n[r]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t},l=[].slice;n=function(t){function n(t){this.message=t}return a(n,t),n.prototype.name="ValueError",n}(Error),u="cannot switch from implicit to explicit numbering",i="cannot switch from explicit to implicit numbering",r=function(t){return null==t&&(t={}),function(){var e,r,o,s,c,a;return a=arguments[0],e=2<=arguments.length?l.call(arguments,1):[],o=0,r=s=!1,c="cannot switch from {} to {} numbering",a.replace(/([{}])\1|[{](.*?)(?:!(.+?))?[}]/g,function(c,a,l,p){var h,d,v;if(a)return a;if(l.length){if(s)throw new n(u);r=!0,h=null!=(d=f(e,l))?d:""}else{if(r)throw new n(i);s=!0,h=null!=(v=e[o++])?v:""}return Object.prototype.hasOwnProperty.call(t,p)?t[p](h):h})}},f=function(t,n){var e;for(/^(\d+)([.]|$)/.test(n)||(n="0."+n);e=/(.+?)[.](.+)/.exec(n);)t=s(t,e[1]),n=e[2];return s(t,n)},s=function(t,n){var e;return e=t[n],"function"==typeof e?e.call(t):e},o=r({}),o.create=r,o.extend=function(t,n){var e;e=r(n),t.format=function(){return e.apply(null,[this].concat(l.call(arguments)))}},"undefined"!=typeof e?e.exports=o:"function"==typeof t&&t.amd?t(o):window.format=o}).call(this)},{}]},{},[1])(1)});